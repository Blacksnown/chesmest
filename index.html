<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CÃ¢y ThÃ´ng Noel Nháº¥p NhÃ¡y</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="sparkle-bg" aria-hidden="true"></div>
    <div class="tree">
      <div class="star">â˜…</div>
      <div class="light light1"></div>
      <div class="light light2"></div>
      <div class="light light3"></div>
      <div class="trunk"></div>
    </div>

    <!-- Tuyáº¿t -->
    <div class="snow"></div>
    <div class="snow"></div>
    <div class="snow"></div>
    <div class="snow"></div>
    <div class="snow"></div>
    <div class="snow"></div>

    <div class="tree">
      <div class="star">â˜…</div>

      <div class="layer"></div>
      <div class="layer"></div>
      <div class="layer"></div>

      <div class="trunk"></div>

      <!-- ÄÃ¨n -->
      <div class="light" style="top: 60rem; left: -20rem; background: red"></div>
      <div
        class="light"
        style="top: 90rem; left: 20rem; background: yellow"
      ></div>
      <div
        class="light"
        style="top: 130rem; left: -40rem; background: blue"
      ></div>
      <div
        class="light"
        style="top: 160rem; left: 40rem; background: purple"
      ></div>
      <div
        class="light"
        style="top: 200rem; left: -60rem; background: orange"
      ></div>
      <div class="light" style="top: 230rem; left: 60rem; background: cyan"></div>
    </div>
    <div id="ascii-tree-container" aria-label="ASCII tree"></div>

    <div class="controls">
      <label for="tree-size" class="visually-hidden">KÃ­ch thÆ°á»›c cÃ¢y</label>
      <select id="tree-size" class="control" aria-label="KÃ­ch thÆ°á»›c cÃ¢y">
        <option value="small">CÃ¢y nhá»</option>
        <option value="large">CÃ¢y lá»›n</option>
      </select>
      <label for="tree-style" class="visually-hidden">Kiá»ƒu cÃ¢y</label>
      <select id="tree-style" class="control" aria-label="Kiá»ƒu cÃ¢y">
        <option value="ascii">ASCII</option>
        <option value="fancy">Fancy (Ä‘áº¹p)</option>
      </select>
      <button id="toggle-lights" class="control">Táº¯t Ä‘Ã¨n</button>
      <div class="zoom-controls" aria-hidden="false">
        <button id="zoom-out" class="control" title="Thu nhá»">âˆ’</button>
        <input id="zoom-range" type="range" min="12" max="45" value="28" />
        <button id="zoom-in" class="control" title="PhÃ³ng to">+</button>
      </div>
    </div>

    <!--     Lá»i chÃºc -->
    <div class="message">
      <p>ğŸ„ GiÃ¡ng Sinh an lÃ nh, HÃ  My yÃªu dáº¥u!</p>
      <p>âœ¨ Anh há»©a sáº½ mÃ£i yÃªu thÆ°Æ¡ng vÃ  che chá»Ÿ cho em.</p>
      <p>ğŸ’– DÃ¹ mÃ¹a Ä‘Ã´ng láº¡nh giÃ¡, trÃ¡i tim anh luÃ´n áº¥m Ã¡p vÃ¬ cÃ³ em.</p>
    </div>
    <script type="module">
      import {
        smallTree,
        largeTree,
        renderTree,
        renderFancyTree,
      } from "./tree.js";

      document.addEventListener("DOMContentLoaded", () => {
        const container = document.getElementById("ascii-tree-container");
        // helper to render based on style & size
        const styleSelect = document.getElementById("tree-style");
        const sizeSelect = document.getElementById("tree-size");

        function renderCurrent() {
          const style = styleSelect?.value || "ascii";
          const size = sizeSelect?.value || "small";
          if (style === "fancy") {
            // render the CSS/DOM fancy tree
            renderFancyTree(container, { size });
          } else {
            const data = size === "large" ? largeTree : smallTree;
            renderTree(container, { className: "ascii-tree", data });
          }
          // reapply zoom to newly rendered tree
          setZoom(Number(zoomRange?.value || 28));
        }

        // wire selectors
        sizeSelect?.addEventListener("change", renderCurrent);
        styleSelect?.addEventListener("change", renderCurrent);

        // Toggle blinking lights (pause/resume)
        const btn = document.getElementById("toggle-lights");
        btn?.addEventListener("click", () => {
          document.querySelectorAll(".light").forEach((el) => {
            const paused = el.classList.toggle("paused");
            if (paused) el.style.animationPlayState = "paused";
            else el.style.animationPlayState = "";
          });
          if (btn.textContent?.trim() === "Táº¯t Ä‘Ã¨n")
            btn.textContent = "Báº­t Ä‘Ã¨n";
          else btn.textContent = "Táº¯t Ä‘Ã¨n";
        });

        // Zoom controls for the ASCII tree
        const pre = document.querySelector(".ascii-tree");
        const zoomRange = document.getElementById("zoom-range");
        const zoomIn = document.getElementById("zoom-in");
        const zoomOut = document.getElementById("zoom-out");
        function setZoom(px) {
          const asciiEl = document.querySelector(".ascii-tree");
          const fancyEl = document.querySelector(".fancy-wrapper");
          if (asciiEl) {
            asciiEl.style.fontSize = px + "px";
          }
          if (fancyEl) {
            // scale fancy wrapper
            const scale = px / 28; // base 28
            fancyEl.style.transform = `scale(${scale})`;
          }
          if (zoomRange) zoomRange.value = px;
        }
        zoomIn?.addEventListener("click", () => {
          const v = Math.min(56, Number(zoomRange.value) + 2);
          setZoom(v);
        });
        zoomOut?.addEventListener("click", () => {
          const v = Math.max(12, Number(zoomRange.value) - 2);
          setZoom(v);
        });
        zoomRange?.addEventListener("input", (e) => {
          setZoom(e.target.value);
        });
        // apply initial zoom value from range then render initial tree
        setZoom(Number(zoomRange?.value || 28));
        renderCurrent();

        // create twinkling background lights
        function createSparkles(count = 60) {
          const bg = document.getElementById("sparkle-bg");
          if (!bg) return;
          // clear any existing
          bg.innerHTML = "";
          for (let i = 0; i < count; i++) {
            const s = document.createElement("span");
            s.className = "sparkle";
            const size = Math.round(6 + Math.random() * 18);
            const left = Math.random() * 100;
            const top = Math.random() * 100;
            const delay = (Math.random() * 5).toFixed(2);
            const duration = 2 + Math.random() * 4;
            s.style.width = size + "px";
            s.style.height = size + "px";
            s.style.left = left + "%";
            s.style.top = top + "%";
            s.style.animationDelay = delay + "s";
            s.style.animationDuration = duration + "s";
            // tint - subtle color variations
            const hue = 40 + Math.round(Math.random() * 120);
            s.style.background = `radial-gradient(circle at 30% 30%, rgba(255,255,220,0.95), rgba(255,255,220,0.7) 30%, rgba(0,0,0,0) 60%), hsl(${hue} 90% 65% / 0.55)`;
            bg.appendChild(s);
          }
        }

        // create initial sparkles and recreate on resize for nicer distribution
        createSparkles(70);
        window.addEventListener("resize", () => createSparkles(60));
      });
    </script>
  </body>
</html>
